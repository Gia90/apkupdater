package com.apkupdater.adapter;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

import android.content.Context;
import android.support.annotation.NonNull;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;

import com.apkupdater.model.LogMessage;
import com.apkupdater.view.LogView;
import com.apkupdater.view.LogView_;

import org.androidannotations.annotations.EBean;
import org.androidannotations.annotations.RootContext;
import org.androidannotations.annotations.UiThread;

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

@EBean(scope = EBean.Scope.Singleton)
public class LogAdapter
	extends ArrayAdapter<LogMessage>
{
	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	@RootContext
	Context context;

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public LogAdapter(
		Context context
	) {
		super(context, 0);
	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	@Override
	@NonNull
	public View getView(
		int position,
		View convertView,
		@NonNull ViewGroup parent
	) {
		LogView log;

		if (convertView == null) {
			log = LogView_.build(context);
		} else {
			log = (LogView) convertView;
		}

		log.bind(getItem(position));

		return log;
	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	@UiThread(propagation = UiThread.Propagation.REUSE)
	public void log(
		String title,
		String message,
		int severity
	) {
		add(new LogMessage(title, message, severity));
	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	@Override
	public void notifyDataSetChanged(
	) {
		super.notifyDataSetChanged();
	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	public LogMessage[] getValues(
	) {
		LogMessage [] values = new LogMessage[getCount()];
		for (int i = 0; i < getCount(); i++) {
			values[i] = getItem(i);
		}
		return values;
	}

	////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

